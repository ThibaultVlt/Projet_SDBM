CREATE DATABASE SDBM
GO
USE SDBM
GO
CREATE TABLE COULEUR
(
	ID_COULEUR int IDENTITY(1,1) NOT NULL,
	NOM_COULEUR varchar(25) NOT NULL,
	CONSTRAINT PK_COULEUR PRIMARY KEY CLUSTERED 
	(
		ID_COULEUR ASC
	)
) 
GO

CREATE TABLE CONTINENT
(
	ID_CONTINENT int IDENTITY(1,1) NOT NULL,
	NOM_CONTINENT varchar(25) NOT NULL,
	CONSTRAINT PK_CONTINENT PRIMARY KEY NONCLUSTERED 
	(
		ID_CONTINENT ASC
	)
)
GO

CREATE TABLE PAYS
(
	ID_PAYS int IDENTITY(1,1) NOT NULL,
	NOM_PAYS varchar(40) NOT NULL,
	ID_CONTINENT int NOT NULL,
	CONSTRAINT PK_PAYS PRIMARY KEY NONCLUSTERED 
	(
		ID_PAYS ASC
	)
)
GO

CREATE TABLE TYPEBIERE
(
	ID_TYPE int IDENTITY(1,1) NOT NULL,
	NOM_TYPE varchar(25) NOT NULL,
	CONSTRAINT PK_TYPEBIERE PRIMARY KEY NONCLUSTERED 
	(
		ID_TYPE ASC
	)
)
GO

CREATE TABLE FABRICANT
(
	ID_FABRICANT int IDENTITY(1,1) NOT NULL,
	NOM_FABRICANT varchar(40) NOT NULL,
	CONSTRAINT PK_FABRICANT PRIMARY KEY NONCLUSTERED 
	(
		ID_FABRICANT ASC
	)
) 
GO

CREATE TABLE MARQUE
(
	ID_MARQUE int IDENTITY(1,1) NOT NULL,
	NOM_MARQUE varchar(40) NOT NULL,
	ID_PAYS int NULL,
	ID_FABRICANT int NULL,
	CONSTRAINT PK_MARQUE PRIMARY KEY NONCLUSTERED 
	(
		ID_MARQUE ASC
	)
) 
GO


ALTER TABLE MARQUE  WITH CHECK ADD CONSTRAINT FK_MARQUE_FABRICANT FOREIGN KEY(ID_FABRICANT)
REFERENCES FABRICANT (ID_FABRICANT)
GO

ALTER TABLE MARQUE  WITH CHECK ADD CONSTRAINT FK_MARQUE_PAYS FOREIGN KEY(ID_PAYS)
REFERENCES PAYS (ID_PAYS)
GO


ALTER TABLE PAYS  WITH CHECK ADD  CONSTRAINT FK_PAYS_CONTINENT FOREIGN KEY(ID_CONTINENT)
REFERENCES CONTINENT (ID_CONTINENT)
GO

CREATE TABLE ARTICLE
(
	ID_ARTICLE int IDENTITY(1,1) NOT NULL,
	NOM_ARTICLE varchar(60) NOT NULL,
	PRIX_ACHAT float NOT NULL,
	VOLUME int NULL,
	TITRAGE float NULL,
	ID_MARQUE int NOT NULL,
	ID_COULEUR int NULL,
	ID_TYPE int NULL,
	CONSTRAINT PK_ARTICLE PRIMARY KEY NONCLUSTERED 
	(
		ID_ARTICLE ASC
	)
)
GO

ALTER TABLE ARTICLE  WITH CHECK ADD  CONSTRAINT FK_ARTICLE_COULEUR FOREIGN KEY(ID_COULEUR)
REFERENCES COULEUR (ID_COULEUR)
GO


ALTER TABLE ARTICLE  WITH CHECK ADD  CONSTRAINT FK_ARTICLE_MARQUE FOREIGN KEY(ID_MARQUE)
REFERENCES MARQUE (ID_MARQUE)
GO


ALTER TABLE ARTICLE WITH CHECK ADD  CONSTRAINT FK_ARTICLE_TYPEBIERE FOREIGN KEY(ID_TYPE)
REFERENCES TYPEBIERE (ID_TYPE)
GO


CREATE TABLE TICKET(
	ANNEE int NOT NULL,
	NUMERO_TICKET int NOT NULL,
	DATE_VENTE datetime NOT NULL,
	CONSTRAINT PK_VENTE PRIMARY KEY NONCLUSTERED 
	(
		ANNEE ASC,
		NUMERO_TICKET ASC
	)
) 
GO


CREATE TABLE VENDRE
(
	ANNEE int NOT NULL,
	NUMERO_TICKET int NOT NULL,
	ID_ARTICLE int NOT NULL,
	QUANTITE int NULL,
	PRIX_VENTE money,
	CONSTRAINT PK_VENDRE PRIMARY KEY NONCLUSTERED 
	(
		ANNEE ASC,
		NUMERO_TICKET ASC,
		ID_ARTICLE ASC
	)
)

ALTER TABLE VENDRE  WITH CHECK ADD  CONSTRAINT FK_VENDRE_ARTICLE FOREIGN KEY(ID_ARTICLE)
REFERENCES ARTICLE (ID_ARTICLE)
GO


ALTER TABLE VENDRE  WITH CHECK ADD  CONSTRAINT FK_VENDRE_TICKET FOREIGN KEY(ANNEE, NUMERO_TICKET)
REFERENCES TICKET (ANNEE, NUMERO_TICKET)
GO

alter table article with check
add constraint  CK_ARTICLE_PRIX_ACHAT check (prix_achat > 0.5)
go
alter table article with check
add constraint CK_ARTICLE_TITRAGE check (titrage between 0.5 and 26)
go
alter table article with check
add constraint CK_ARTICLE_VOLUME check (volume in (33,75))
go
alter table ticket
add constraint DF_TICKET_DATE default (getdate()) for date_vente